<template>
	<div class="about">
		<v-app-bar color="deep-purple" dark>
			<v-app-bar-title> Todo List </v-app-bar-title>
		</v-app-bar>
		<h1 class="text-center">My To Do List</h1>
		<ToDoInputCard></ToDoInputCard>
		<br />
		<h2>Complete ToDos</h2>
		<v-container class="d-flex justify-space-around flex-wrap">
			<div v-for="todo in isCompleted" v-bind:key="todo.id">
				<to-do-item-card
					@editToDo="editToDo"
					v-bind:todo="todo"
				></to-do-item-card>
			</div>
		</v-container>
		<h2>InComplete ToDos</h2>
		<v-container class="d-flex justify-space-around flex-wrap">
			<div v-for="todo in isIncompleted" v-bind:key="todo.id">
				<to-do-item-card
					@editToDo="editToDo"
					v-bind:todo="todo"
				></to-do-item-card>
			</div>
		</v-container>
	</div>
</template>

<script lang="ts">
import { Component, Vue, Watch } from 'vue-property-decorator';
// imports components
import ToDoItemCard from '../components/ToDoItemCard.vue';
import ToDoInputCard from '../components/ToDoInputCard.vue';
import store, { Todo } from '@/store';
import Services from '../Services/index';

// adds components
@Component({ components: { ToDoItemCard, ToDoInputCard } })
export default class HomeView extends Vue {
	public todoToAdd: Todo = {
		title: '',
		description: '',
		id: 0,
		isCompleted: false,
		imageUrl: '',
	};

	isFormValid = false;

	public addToDoItem(): void {
		if (!this.isFormValid) {
			return;
		}
	}

	//gets the filtered complete messages
	get isCompleted() {
		return this.$store.getters.getCompleteToDos;
	}
	//gets the filtered incomplete messages
	get isIncompleted() {
		return this.$store.getters.getIncompleteToDos;
	}
	public editToDo(id: string) {
		console.log(id);
	}
	//gets initial todos and images
	public async getToDos(): Promise<void> {
		const Service = new Services();
		let loaded = false;
		console.log(loaded);
		for (let i = 1; i < 5; i++) {
			let todo = await Service.getTodo(i);
			let image = await Service.getImage();
			let newToDo = {
				title: todo.title,
				description: 'This ToDo is random',
				id: new Date().getTime(),
				isCompleted: todo.completed,
				imageUrl: image.url,
			};
			console.log(newToDo);
			store.dispatch('addToDo', newToDo);
		}
		loaded = true;
	}
	//calls the method to get initial commits on load, would ideally have a loader/spinner aswell
	public mounted() {
		this.getToDos();
	}
}
</script>

<style lang="scss"></style>
